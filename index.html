<!doctype html>
<html>
   <meta charset="utf-8">
   <head>
      <style>
          svg {
              border: 1px solid black;
          }
          text {
              font-size: 60px;
              text-anchor: middle;
              fill: gold;
          }
      </style>
   </head>
   <body>
      tipo:
      <select id="typeSVG">
         <option value="Array">Arreglo</option>
         <option value="Variable">Variable</option>
      </select>
      Nombre de la variable: <input id="nameVar" type="text">
      elementos del arreglo(si aplica): <input id="numElements" type="number">
      <button id="addSVG">agregar SVG</button>
      <br>
      Variable a modificar (para una posición en el arreglo usar el formato arr[i] con i, el index a modificar): <input id="nameVarMod" type="text">
      valor: <input id="valueVarMod" type="number">
      <button id="ModifySVG">modificar SVG</button>

      <svg id="containerSVG"  style="width: 1400px; height:900px; display: flex; flex-flow: row wrap">
         <style>
             .small{ font: italic 12px sans-serif; fill: black;}
         </style>
      </svg>
   </body>

   <script>
      function create_svg(type, svg_attributes, properties) {
         let node = document.createElementNS("http://www.w3.org/2000/svg", type);
         for (let name in svg_attributes) {
            node.setAttributeNS(null, name, svg_attributes[name]);
         }
         for (let name in properties) {
            node[name] = properties[name];
         }
         return node;
      }
      const posX = 30, posY = 30;
      const container = document.getElementById("containerSVG");
      let idVar = new Set( ), cx = posX, cy = posY, tam = 60;

      const addSVG = document.getElementById("addSVG");
      addSVG.addEventListener("click", function() {
         let selectSVG = document.getElementById('typeSVG').options;
         selectSVG = selectSVG[selectSVG.selectedIndex].value;

         const num = document.getElementById("numElements").value;
         const name = document.getElementById('nameVar').value;
         const value = 645645;
         if(isUsed(name)){
            alert('El nombre de la variable está en uso');
            return;
         }

         if(selectSVG === "Array"){
            createArr(name, num, value);
         }else if(selectSVG === "Variable") {
            createVar(name, value);
         }
         idVar.add('svg|' + name + '|');
      });

      const modSVG = document.getElementById("ModifySVG");
      modSVG.addEventListener('click', function (){
         const name = document.getElementById('nameVarMod').value;
         const value = document.getElementById('valueVarMod').value;
         if(name && value){
            modifyBox(name, value);
         }else{
            alert('Se requiere llenar el nombre y el valor');
         }
      });
      function isUsed(name){
         return idVar.has('svg|' + name + '|');
      }
      function createArr(name, num, value){
         if(cx + tam * num + tam >= 1400){
            cx = posX;
            cy += 150;
            if(cy >= 900 || cx + tam * num + tam >= 1400){
               alert("El arreglo es demasiado grande");
               return;
            }
         }
         //Create the name of the array
         let node = create_svg("text", { "x": cx, "y": cy + 5 + tam / 2, "text-anchor": "middle", "class": "small"}, { "textContent": name + ':'});
         node.id = `svg|${name}|`;
         container.appendChild(node);
         cx+= tam / 2;

         //Create array
         for(let index = 0; index < num; ++index){
            createBox(index, value, name);
            cx+=tam;
         }
         cx+=tam;
      }
      function createVar(name, value){
         if(cx + tam >= 1400){
            cx = posX;
            cy += 150;
            if(cy >= 900){
               alert("Espacio lleno");
               return;
            }
         }
         createBox(name, value, "");
         cx += 2 * tam;
      }
      function createBox(name, value, father){
         // Create variable's name
         let node;
         node = create_svg("text", { "x": cx + tam / 2, "y": cy + 15 + tam, "text-anchor":"middle", "class": "small"}, { "textContent": name });
         node.id = father === '' ? (`svg|${name}|`) : (`svg|${father}[${name}]|name`);
         container.appendChild(node);

         //Create box variable
         node = create_svg('rect', { "x": cx, "y": cy, "width": tam, "height": tam, "fill": "white", "stroke":"black"});
         node.id = father === '' ? (`svg|${name}|box`) : (`svg|${father}[${name}]|box`);
         container.appendChild(node);

         //Create content
         node = create_svg("text", { "x": cx + tam / 2, "y": cy + 5 + tam / 2, "text-anchor":"middle", "class": "small"}, { "textContent": value });
         node.id = father === '' ? (`svg|${name}|value`) : (`svg|${father}[${name}]|value`);
         container.appendChild(node);
      }
      function modifyBox(name, value){
         let node = document.getElementById(`svg|${name}|value`);
         if(node){
            node.textContent = value;
         }else{
            alert('No existe la variable ' + `svg|${name}|value`);
         }
      }
   </script>
</html>